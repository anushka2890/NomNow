<div class="cart-sidebar">
  <div *ngIf="(cartItems$ | async) as items">

    <!-- Header -->
    <div class="cart-header">
      <h3>Your Cart</h3>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>

    <!-- Empty Cart -->
    <div *ngIf="items.length === 0" class="empty-cart">
      Your cart is empty.
    </div>

    <!-- Items in Cart -->
    <div *ngIf="items.length > 0">
      <div class="cart-items">
        <div *ngFor="let item of items" class="cart-item">
          <div class="item-info">
            <div class="item-name-row">
              <div class="item-name">{{ item.name }}</div>
              <div class="item-quantity-controls">
                <button (click)="decrement(item)">−</button>
                <span>{{ item.quantity }}</span>
                <button (click)="increment(item)">+</button>
              </div>
            </div>
            <div class="item-price">₹{{ item.price }} x {{ item.quantity }}</div>
          </div>
        </div>
      </div>

      <!-- Offers Section -->
      <!-- Offers Dropdown or List -->
<div class="offers-section" *ngIf="availableOffers.length > 0">
  <label>Available Offers:</label>
  <div *ngIf="errorMessage" class="offer-error">
  {{ errorMessage }}
</div>
  <div class="offer-list">
    <div 
      *ngFor="let offer of availableOffers" 
      class="offer-item"
      [class.selected]="selectedOffer?.id === offer.id"
      (click)="selectOffer(offer)">
      <strong>{{ offer.title }}</strong><br />
      <small>
        {{ offer.offerType === 'FLAT' ? '₹' + offer.discountAmount + ' OFF' : offer.discountAmount + '% OFF' }}
      </small>
    </div>
  </div>
</div>

<!-- Show applied offer badge -->
      <div *ngIf="selectedOffer" class="selected-offer">
        Offer Applied: {{ selectedOffer.title }}
        <button class="remove-offer-btn" (click)="removeOffer()">✖</button>
      </div>



      <!-- Totals -->
      <div class="cart-footer">
        <div class="total" *ngIf="selectedOffer">
          Discounted Total: ₹{{ getDiscountedTotal(items) }}
        </div>
        <div class="total" *ngIf="!selectedOffer">
          Total: ₹{{ getTotal(items) }}
        </div>

       
        <!-- Checkout Button -->
        <button class="checkout-btn" (click)="openCheckout()">Checkout</button>

        <!-- Checkout Modal -->
        <app-checkout-modal
          *ngIf="showCheckoutModal"
          [cartItems]="items"
          [totalPrice]="getDiscountedTotal(items)"
          (close)="closeCheckout()"
        ></app-checkout-modal>
      </div>
    </div>
  </div>
</div>
