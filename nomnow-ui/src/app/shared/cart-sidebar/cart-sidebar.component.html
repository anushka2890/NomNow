<div class="cart-sidebar">
  <div *ngIf="(cartItems$ | async) as items">
    
    <!-- Always show header with Close -->
    <div class="cart-header">
      <h3>Your Cart</h3>
      <button class="close-btn" (click)="onClose()">×</button>
    </div>

    <!-- If Cart is Empty -->
    <div *ngIf="items.length === 0" class="empty-cart">
      Your cart is empty.
    </div>

    <!-- If Cart has Items -->
    <div *ngIf="items.length > 0">
      <div class="cart-items">
        <div *ngFor="let item of items; let i = index" class="cart-item">
          <div class="item-info">
            <div class="item-name-row">
              <div class="item-name">{{ item.name }}</div>
              <div class="item-quantity-controls">
                <button (click)="decrement(item)">−</button>
                <span>{{ item.quantity }}</span>
                <button (click)="increment(item)">+</button>
              </div>
            </div>
            <div class="item-price">₹{{ item.price }} x {{ item.quantity }}</div>
          </div>
          
        </div>
      </div>

      <!-- Promo Code Input -->
      <div class="promo-code-section">
        <input
          type="text"
          [(ngModel)]="promoCode"
          placeholder="Enter or select promo code"
          list="availablePromoCodes"
        />
        <datalist id="availablePromoCodes">
          <option *ngFor="let code of promoCodes" [value]="code"></option>
        </datalist>
        <button (click)="applyPromoCode()">Apply</button>
      </div>
      <div class="promo-message" *ngIf="promoMessage">{{ promoMessage }}</div>

      <div class="cart-footer">
        <!-- Show discounted total only if promo is applied -->
        <div class="total" *ngIf="promoApplied">
          Discounted Total: ₹{{ getDiscountedTotal(items) }}
        </div>
        <div class="total" *ngIf="!promoApplied">
          Total: ₹{{ getTotal(items) }}
        </div>

        

        <!-- Checkout Button -->
        <button class="checkout-btn" (click)="openCheckout()">Checkout</button>

        <!-- Checkout Modal -->
        <app-checkout-modal
          *ngIf="showCheckoutModal"
          [cartItems]="items"
          [totalPrice]="getDiscountedTotal(items)"
          (close)="closeCheckout()"
        ></app-checkout-modal>
      </div>
    </div>
  </div>
</div>
